<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Hand Tracking + 3D Model</title>
<style>
    body { margin: 0; overflow: hidden; background: #000; }
    video { display: none; }
</style>

<!-- Three.js -->
<script type="module">
import * as THREE from 'https://unpkg.com/three@0.157.0/build/three.module.js';
import { GLTFLoader } from 'https://unpkg.com/three@0.157.0/examples/jsm/loaders/GLTFLoader.js';

/* âœ… Mediapipe Hands */
import { Camera } from 'https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js';
import { Hands } from 'https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js';

let scene, camera3D, renderer, handModel, bones = [];

init();

async function init() {

    // ðŸŽ¥ CÃ¡mara 3D
    scene = new THREE.Scene();
    camera3D = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
    camera3D.position.set(0, 1, 3);

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(innerWidth, innerHeight);
    document.body.appendChild(renderer.domElement);

    // ðŸ’¡ Luz
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(2, 2, 3);
    scene.add(light);

    // âœ‹ Cargar tu mano 3D
    const loader = new GLTFLoader();
    loader.load('./rigged_hand.glb', gltf => {
        handModel = gltf.scene;
        scene.add(handModel);

        handModel.traverse(obj => {
            if (obj.isBone) bones.push(obj);
        });

        console.log("âœ… Huesos detectados:", bones);
    });

    animate();

    /* âœ… Mediapipe Hands Config */
    const video = document.createElement('video');
    video.width = 640;
    video.height = 480;

    const hands = new Hands({
        locateFile: (file) =>
            `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
    });

    hands.setOptions({
        maxNumHands: 1,
        modelComplexity: 1,
        minDetectionConfidence: 0.7,
        minTrackingConfidence: 0.7
    });

    hands.onResults(onResults);

    const cam = new Camera(video, {
        onFrame: async () => { await hands.send({ image: video }) },
        width: video.width,
        height: video.height
    });
    cam.start();
}

function onResults(results) {
    if (!results.multiHandLandmarks.length) return;
    const lm = results.multiHandLandmarks[0];
    console.log("ðŸŸ¢ Landmarks:", lm);
    // âœ… PrÃ³ximo paso: mapear landmarks a huesos
}

function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera3D);
}

window.addEventListener('resize', () => {
    camera3D.aspect = innerWidth / innerHeight;
    camera3D.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
});
</script>
</head>
<body></body>
</html>
